<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=/assets/style.css rel=stylesheet><link href=https://stigsen.dev/atom.xml rel=alternate title=RSS type=application/atom+xml><meta content="Benjamin Stigsen" name=author><meta content="Adding HTTPS/TLS with the certmagic module. " name=description><link href=/assets/syntax.css rel=stylesheet><meta content="go, golang, https, tls, ssl, certmagic, caddy" name=keywords><title>Enabling HTTPS in a Go Application</title><body><header><h1>Benjamin Stigsen</h1><nav><a href=/>Home</a><a href=/blog>Blog</a><a href=/notes>Notes</a></nav></header><main><h2>Enabling HTTPS in a Go Application</h2><time datetime=2024-11-21>2024-11-21</time><p>If you don't want to use a reverse proxy like Caddy or Nginx, you can add HTTPS support directly to your Go application, using the module <code>certmagic</code>, developed by the people behind the Caddy server project.<sup class=footnote-reference><a href=#1>1</a></sup><h3 id=setup><a aria-label="Anchor link for: setup" class=zola-anchor href=#setup>Setup</a></h3><p>Install the <code>certmagic</code> module: <code>go get github.com/caddyserver/certmagic</code><p>Write your code:<pre class="language-go z-code" data-lang=go><code class=language-go data-lang=go><span class="z-source z-go"><span class="z-keyword z-other z-package z-go">package</span> <span class="z-variable z-other z-go">main</span>
</span><span class="z-source z-go">
</span><span class="z-source z-go"><span class="z-keyword z-other z-import z-go">import</span> <span class="z-punctuation z-section z-parens z-begin z-go">(</span>
</span><span class="z-source z-go">	<span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>flag<span class="z-punctuation z-definition z-string z-end z-go">"</span></span>
</span><span class="z-source z-go">	<span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>net/http<span class="z-punctuation z-definition z-string z-end z-go">"</span></span>
</span><span class="z-source z-go">
</span><span class="z-source z-go">	<span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>github.com/caddyserver/certmagic<span class="z-punctuation z-definition z-string z-end z-go">"</span></span>
</span><span class="z-source z-go"><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span><span class="z-source z-go">
</span><span class="z-source z-go"><span class="z-storage z-type z-keyword z-function z-go">func</span> <span class="z-entity z-name z-function z-go">main</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-punctuation z-section z-parens z-end z-go">)</span> <span class="z-meta z-block z-go"><span class="z-punctuation z-section z-braces z-begin z-go">{</span>
</span></span><span class="z-source z-go"><span class="z-meta z-block z-go">	<span class="z-variable z-declaration z-go">production</span> <span class="z-keyword z-operator z-assignment z-go">:=</span> <span class="z-variable z-other z-go">flag</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-function z-go">Bool</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>production<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-separator z-go">,</span> <span class="z-constant z-language z-go">false</span><span class="z-punctuation z-separator z-go">,</span> <span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>run in production mode (https)<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span><span class="z-source z-go"><span class="z-meta z-block z-go">	<span class="z-variable z-other z-go">flag</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-function z-go">Parse</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span><span class="z-source z-go"><span class="z-meta z-block z-go">
</span></span><span class="z-source z-go"><span class="z-meta z-block z-go">	<span class="z-variable z-other z-go">http</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-function z-go">HandleFunc</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>/<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-separator z-go">,</span> <span class="z-storage z-type z-keyword z-function z-go">func</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-variable z-parameter z-go">res</span> <span class="z-variable z-other z-go">http</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-storage z-type z-go">ResponseWriter</span><span class="z-punctuation z-separator z-go">,</span> <span class="z-variable z-parameter z-go">req</span> <span class="z-keyword z-operator z-go">*</span><span class="z-variable z-other z-go">http</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-storage z-type z-go">Request</span><span class="z-punctuation z-section z-parens z-end z-go">)</span> <span class="z-meta z-block z-go"><span class="z-punctuation z-section z-braces z-begin z-go">{</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">		<span class="z-variable z-other z-go">res</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-function z-go">Write</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-punctuation z-section z-brackets z-begin z-go">[</span><span class="z-punctuation z-section z-brackets z-end z-go">]</span><span class="z-storage z-type z-go"><span class="z-support z-type z-builtin z-go">byte</span></span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>Hello World!<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-section z-parens z-end z-go">)</span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">	<span class="z-punctuation z-section z-braces z-end z-go">}</span></span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span><span class="z-source z-go"><span class="z-meta z-block z-go">
</span></span><span class="z-source z-go"><span class="z-meta z-block z-go">	<span class="z-keyword z-control z-go">if</span> <span class="z-keyword z-operator z-go">*</span><span class="z-variable z-other z-go">production</span> <span class="z-meta z-block z-go"><span class="z-punctuation z-section z-braces z-begin z-go">{</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">		<span class="z-variable z-function z-go"><span class="z-support z-function z-builtin z-go">println</span></span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>Running webserver in production<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">		<span class="z-variable z-other z-go">certmagic</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-other z-member z-go">DefaultACME</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-other z-member z-go">Email</span> <span class="z-keyword z-operator z-assignment z-go">=</span> <span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>email@website.com<span class="z-punctuation z-definition z-string z-end z-go">"</span></span> <span class="z-comment z-line z-go"><span class="z-punctuation z-definition z-comment z-go">//</span> optional but recommended
</span></span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">		<span class="z-variable z-other z-go">certmagic</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-function z-go">HTTPS</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-punctuation z-section z-brackets z-begin z-go">[</span><span class="z-punctuation z-section z-brackets z-end z-go">]</span><span class="z-storage z-type z-go"><span class="z-support z-type z-builtin z-go">string</span></span><span class="z-meta z-block z-go"><span class="z-punctuation z-section z-braces z-begin z-go">{</span><span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>website.com<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-section z-braces z-end z-go">}</span></span><span class="z-punctuation z-separator z-go">,</span> <span class="z-variable z-other z-go">http</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-other z-member z-go">DefaultServeMux</span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">	<span class="z-punctuation z-section z-braces z-end z-go">}</span></span> <span class="z-keyword z-control z-go">else</span> <span class="z-meta z-block z-go"><span class="z-punctuation z-section z-braces z-begin z-go">{</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">		<span class="z-variable z-function z-go"><span class="z-support z-function z-builtin z-go">println</span></span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>Running webserver on http://localhost:8080<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">		<span class="z-variable z-other z-go">http</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-function z-go">ListenAndServe</span><span class="z-punctuation z-section z-parens z-begin z-go">(</span><span class="z-string z-quoted z-double z-go"><span class="z-punctuation z-definition z-string z-begin z-go">"</span>localhost:8080<span class="z-punctuation z-definition z-string z-end z-go">"</span></span><span class="z-punctuation z-separator z-go">,</span> <span class="z-variable z-other z-go">http</span><span class="z-punctuation z-accessor z-dot z-go">.</span><span class="z-variable z-other z-member z-go">DefaultServeMux</span><span class="z-punctuation z-section z-parens z-end z-go">)</span>
</span></span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-meta z-block z-go">	<span class="z-punctuation z-section z-braces z-end z-go">}</span></span>
</span></span><span class="z-source z-go"><span class="z-meta z-block z-go"><span class="z-punctuation z-section z-braces z-end z-go">}</span></span>
</span></code></pre><p>To run the HTTP server with TLS/HTTPS enabled:<br> <code>go run main.go -production</code><hr><p><strong>Note:</strong> Unless you have it set up by other means, <code>certmagic</code> does not support HTTPS on <code>localhost</code>.<br> <strong>Note:</strong> Multiple Go applications running on the same port will panic. In this case use a reverse-proxy.<hr><div class=footnote-definition id=1><sup class=footnote-definition-label>1</sup><p><a href=https://github.com/caddyserver/certmagic#readme rel=noopener target=_blank>https://github.com/caddyserver/certmagic#readme</a></div></main><br>